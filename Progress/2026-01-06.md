# 2026-01-06 学習記録

## 完了項目
- Kubernetes Security Deep Dive
- Jargon Index作成

---

## Kubernetes Security

### 学習内容

#### Control Plane構造
- **API Server**: すべての操作の中心（認証・認可・Admission Controlの3層防御）
- **etcd**: クラスタ状態の単一情報源（暗号化必須）
- **Scheduler**: Pod配置決定
- **Controller Manager**: 望ましい状態への収束

#### セキュリティ機構

**API Server保護の3層**
1. **認証（Authentication）**: 誰が接続しているか
2. **認可（Authorization）**: 何をする権限があるか（RBAC）
3. **Admission Control**: その操作を許可するか（ポリシーベース）

**RBAC（Role-Based Access Control）**
- Role/ClusterRole: 権限の定義
- RoleBinding/ClusterRoleBinding: ユーザー/SAへの権限付与
- Namespace内スコープ vs クラスタ全体スコープ

**ServiceAccount（SA）**
- 問題: default SAの自動付与・Token自動マウント
- 対策: Token自動マウント停止（`automountServiceAccountToken: false`）

**Pod Security Standards**
- **Privileged**: 制限なし（開発・デバッグのみ）
- **Baseline**: 既知の特権昇格防止
- **Restricted**: セキュリティ強化（本番推奨）

**Network Policy**
- デフォルト: すべて許可（危険）
- マイクロセグメンテーション: Pod単位で通信制御
- ゼロトラストの実装基盤

**Secrets管理**
- base64は暗号化ではない
- 対策: 外部管理（AWS Secrets Manager, HashiCorp Vault）

---

### 攻撃シナリオ: 5段階の攻撃チェーン

| Stage | 攻撃手法 | 対策 |
|-------|----------|------|
| 1. 初期侵入 | 公開Dashboard/API、脆弱なイメージ | 認証必須化、イメージスキャン |
| 2. 情報収集 | 環境変数、マウント、API探索 | Secrets外部管理、最小権限 |
| 3. 権限確認 | SA権限確認、RBAC探索 | RBAC最小化、監査ログ |
| 4. 横展開 | 他Pod/Nodeへ移動、Network探索 | Network Policy、セグメンテーション |
| 5. 永続化 | DaemonSet作成、認証情報窃取 | Admission Control、IDS |

---

### 実インシデント

**Tesla 2018**
- 原因: Kubernetesダッシュボード無認証公開
- 被害: クリプトマイニング
- 教訓: 「鍵なしで入れて、机に金庫の鍵が金庫番号ごとに整理されている」

**Azure 2021**
- 標的: MLインフラ
- 手法: 複合的設定ミス
- 教訓: クラウドの計算資源 = クリプトマイニングの動機

---

### 攻撃者グループ

| グループ | 拠点 | 標的 | 特徴 |
|----------|------|------|------|
| TeamTNT | ドイツ | Docker/K8s | クラウドネイティブ標的 |
| Kinsing | - | コンテナ | 自動スキャン |
| WatchDog | 中国 | K8s | クラスタ全体標的 |

---

### 洞察

**構造的脆弱性**
- 複合的設定ミス: 単独では問題ない設定の組み合わせが致命的に
- 例: 認証なし + 権限過剰 + Secrets平文

**クラウド時代の脅威モデル**
- 計算資源が潤沢 = 常にクリプトマイニングの動機
- スケーラビリティ = 攻撃の影響範囲拡大

**Linux Kernel Security との対応関係**
| Kubernetes | Linux Kernel |
|------------|--------------|
| RBAC | Capabilities |
| Admission Control | seccomp/AppArmor |
| Network Policy | iptables/eBPF |
| Pod Security | Namespace/Cgroup |

---

## Jargon Index

### 作成内容

**8カテゴリで体系化**
1. Web Security（XSS, SQLi, CSRF等）
2. 認証・認可（OAuth, JWT, RBAC等）
3. 暗号（AES, RSA, TLS等）
4. Linux Kernel Security（Namespace, Capabilities, seccomp等）
5. コンテナ（Docker, OCI, イメージレイヤー等）
6. Kubernetes（RBAC, Admission, Network Policy等）
7. クラウドセキュリティ（IAM, Zero Trust等）
8. 攻撃者・脅威（TeamTNT, APT, Lateral Movement等）

**設計原則の記録**
- Defense in Depth（多層防御）
- Least Privilege（最小権限）
- Zero Trust（ゼロトラスト）
- Security by Design（設計段階からの組み込み）

**学習中の名言**
- 「base64は暗号化ではない」
- 「デフォルトは危険、明示的に制限せよ」
- 「攻撃を理解しなければ防御できない」

### 目的
Phase 2-3で蓄積した用語の情報爆発対策。体系的な索引により、用語間の関連性を把握。

---

## Phase 3 進捗状況

- [x] コンテナセキュリティ
- [x] Docker Deep Dive
- [x] Linux Kernel Security
- [x] Kubernetes Security
- [ ] AWS Security（深掘り残）

---

## 作成ファイル
- `Concepts/kubernetes-deep-dive.md`
- `Resources/jargon-index.md`

---

## 次回予定

### 優先度高
1. **AWS Security深掘り**
   - IAM詳細（Policy評価順序、条件キー）
   - S3セキュリティ（Bucket Policy vs ACL）
   - VPC Security（Security Group, NACL, PrivateLink）
   - 実インシデント分析

2. **Phase 4準備: ペネトレーションテスト基礎**
   - 偵察（Reconnaissance）
   - スキャン（Enumeration）
   - エクスプロイト（Exploitation）
   - 事後処理（Post-Exploitation）

3. **PortSwigger実践演習**
   - SQL Injection Lab
   - XSS Lab
   - CSRF Lab

### 今後の方向性
- 理論（Concepts）と実践（Practice）のバランス
- CTF参加準備（TryHackMe, HackTheBox）
- 自作ラボ環境構築（Projects/）
