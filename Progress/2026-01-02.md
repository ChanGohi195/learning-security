# 2026-01-02 学習ログ

## 今日やったこと

- 暗号基礎（Phase 1）
  - 暗号の目的と基本概念
  - 古典暗号（シーザー暗号、ヴィジュネル暗号）
  - ワンタイムパッド（OTP）
  - 対称鍵暗号 vs 非対称鍵暗号
  - RSA暗号と一方向関数
  - ハイブリッド暗号

## 学んだこと

### 1. 暗号の目的

**通信内容を通信当事者以外から守る**
```
平文 → 暗号化 → 暗号文 → 復号 → 平文
```

### 2. 古典暗号と弱点

**シーザー暗号（換字式）**
- 文字を一定数ずらす（A→D、B→E、...）
- 弱点: 頻度分析（Eが最も多い等）で解読可能

**ヴィジュネル暗号**
- 位置によって変換を変える
- 弱点: 鍵の繰り返しでパターンが見える

**共通の課題**: パターンが見えると破られる

### 3. ワンタイムパッド（OTP）

**理論上解読不可能**
- 鍵を平文と同じ長さにする
- 数学的に証明済み（完全秘匿性）

**問題**: 鍵配送問題
- どうやって鍵を安全に渡すか？
- 鍵を渡すときに盗聴されたら意味がない

### 4. 対称鍵暗号 vs 非対称鍵暗号

| 方式 | 鍵の種類 | 利点 | 課題 |
|------|---------|------|------|
| 対称鍵 | 同じ鍵で暗号化・復号 | 速い | 鍵配送問題 |
| 非対称鍵 | 公開鍵と秘密鍵のペア | 鍵配送問題を解決 | 遅い |

**非対称鍵暗号の仕組み**
- 公開鍵: 誰でも知っていい（暗号化に使う）
- 秘密鍵: 自分だけが持つ（復号に使う）
- 鍵配送問題を解決: 公開鍵は盗聴されてもOK

### 5. RSA暗号と一方向関数

**一方向関数の原理**
```
素数 × 素数 → 積: 簡単（一瞬）
積 → 素因数分解: 極めて困難（数千年）
```

**計算量の非対称性がセキュリティになる**
- 正規ユーザー: 鍵を持っている → 一瞬で復号
- 攻撃者: 鍵がない → 素因数分解 → 数千年

**重要**: 数学的に不可能ではなく、計算量的に不可能

### 6. ハイブリッド暗号

**実用的な解決策（HTTPS等で使用）**

| フェーズ | 暗号方式 | 理由 |
|---------|---------|------|
| 鍵の交換 | 非対称鍵暗号 | 安全に鍵を渡す |
| データ本体 | 対称鍵暗号 | 高速に暗号化 |

**設計思想**: 各暗号方式の利点を組み合わせる

## ユーザーの良い発想（記録）

| 場面 | ユーザーの発想 | 評価 |
|------|---------------|------|
| 最も単純な暗号 | 文字が他の文字に変換されるルールを共有する | 換字式暗号の概念を独力で導出 |
| シーザー暗号の弱点 | 頻度の多い文字に目星をつける | 頻度分析を独力で発見 |
| 頻度分析への対策 | ダミーレターを注入しその位置を共有する | ノイズ注入による撹乱の発想 |
| 繰り返しパターン対策 | 暗号を生み出す暗号のパターンを共有する | メタ暗号・疑似乱数生成の発想 |
| 鍵配送問題の解決 | 受け手と送り手で違う鍵を用いる | 非対称鍵暗号の核心を独力で導出 |
| 非対称鍵の実現方法 | 素数の特定 | RSAの原理を正確に推測 |
| ハイブリッド暗号 | データの構造ごとに振り分ける | 鍵とデータを分けて扱う発想 |
| 全体の本質 | 重い処理を関門として利用する | 計算量的セキュリティの本質を理解 |

## 核心的理解

### 「計算量の非対称性がセキュリティになる」

**セキュリティの本質**
- 数学的不可能性ではない
- 計算量的不可能性（現実的な時間では解けない）
- 正規ユーザーと攻撃者の計算コストに圧倒的な差を作る

**応用範囲**
- RSA暗号: 素因数分解
- 昨日のSYN Cookie: 秘密鍵による検証
- 共通原理: 正規ユーザーは簡単、攻撃者は困難

## 詰まったこと

特になし。対話を通じて各概念を独力で導出できた。

### 理解が深まった点

1. **非対称鍵暗号の必然性**
   - 鍵配送問題という根本的な課題を理解
   - 「受け手と送り手で違う鍵を用いる」という発想を独力で導出

2. **計算量的セキュリティ**
   - 「重い処理を関門として利用する」という本質を理解
   - 昨日のネットワークセキュリティ（SYN Cookie）との共通原理を発見

3. **ハイブリッド暗号の設計思想**
   - 各暗号方式の利点を組み合わせる発想
   - 実用的なトレードオフの理解

---

## 追加学習（後半）

### 7. ハッシュの目的と用途

**ハッシュの特性**
```
データ → ハッシュ関数 → 固定長の値（元に戻せない）
```

**主な用途**
- パスワード保存: 元データを保持しない
- 完全性検証: データの改ざん検知
- デジタル署名: 大量データの要約

**パスワード保存の比較**

| 保存方法 | 問題 |
|---------|------|
| 平文 | DB侵害で即座に漏洩 |
| 暗号化 | 鍵も侵害される可能性 |
| ハッシュ | 元に戻せない（安全） |

### 8. ハッシュへの攻撃と対策

**攻撃手法**

1. **ブルートフォース攻撃**
   - 総当たりでハッシュを計算
   - パスワードが短いと有効

2. **レインボーテーブル**
   - 事前計算済みハッシュのテーブル
   - 「このハッシュ = このパスワード」を一瞬で引く

**対策1: ソルト**
```
パスワード + ランダム文字列 → ハッシュ
```
- レインボーテーブルを無効化
- 同じパスワードでも異なるハッシュ

**対策2: ストレッチング**
- ハッシュを何度も繰り返す
- 意図的に計算を遅くする
- 攻撃者の計算負荷を増大

### 9. パスワード用ハッシュ関数

**安全なハッシュ関数**

| 関数 | 特徴 | 備考 |
|------|------|------|
| bcrypt | ソルト + ストレッチング | 広く使用 |
| scrypt | メモリも大量に使用 | GPU攻撃に強い |
| Argon2 | 最新の推奨 | 2015年コンペ優勝 |

**危険なハッシュ関数**
- MD5: 衝突が見つかっている
- SHA-1: 衝突が見つかっている
- SHA-256: ハッシュ関数としては安全だが、パスワード用途には不適（速すぎる）

### 10. PKI（公開鍵基盤）

**問題**: 公開鍵が本物かどうか確認できない
- 中間者攻撃（MITM）のリスク
- 攻撃者が自分の公開鍵にすり替える

**解決**: 認証局（CA）による署名
```
証明書 = 公開鍵 + 認証局の署名
```

**信頼の連鎖（チェーン）**
```
ルート認証局（OSに事前組み込み）
    ↓ 署名
中間認証局（日常業務担当）
    ↓ 署名
サーバー証明書（example.com等）
```

### 11. PKIの弱点と攻撃

**認証局への攻撃**
- 認証局が侵害されると被害甚大
- 偽の証明書を発行可能

**実例**

| 事例 | 年 | 結果 |
|------|-----|------|
| DigiNotar | 2011 | ルート証明書削除、倒産 |
| CNNIC | 2015 | 主要ブラウザから削除 |

**国家レベルの攻撃**
- 自国CAを強制してルートストアに入れる
- 国内通信を傍受可能に

**対策技術**
- Certificate Transparency: 証明書の発行を公開ログに記録
- CAA（Certification Authority Authorization）レコード: DNSで発行可能なCAを制限

## ユーザーの良い発想（追加分）

| 場面 | ユーザーの発想 | 評価 |
|------|---------------|------|
| ハッシュの用途 | 元データの構造を特定させずに出力だけ渡す | ハッシュの本質を理解 |
| パスワード保存 | 非可逆的暗号化で元の文字列を特定困難にする | 正確な理解 |
| ブルートフォース対策 | パスワード文字数を長くして計算負荷をかける | ユーザー側の有効な対策 |
| ストレッチングの理解 | ハッシュ変換そのものを計算負荷がかかる計算で構成 | 正確な理解 |
| 公開鍵の検証 | 複数の経路から取得して一致するか判定 | 分散的信頼モデルの発想 |
| PKIの弱点 | 信頼できる認証局を偽装すると最大の成果 | 攻撃者視点で正確に把握 |

## 核心的洞察（追加）

### 「セキュリティは最も弱いところで決まる」

**ユーザーの言葉**
> 認証局の仕組みは思ったよりアナログな要素が多い。国家が介入するならここが最大のレバレッジ。攻撃者も同様。PKI関連企業の責任と公共性は業界随一。

**セキュリティの多層性**

| 層 | 内容 | 最も弱いところ |
|-----|------|---------------|
| 暗号 | 数学的原理 | 鍵管理 |
| PKI | ガバナンス | 認証局への信頼 |
| 運用 | 人間の判断 | フィッシング、ソーシャルエンジニアリング |

**技術だけでは完結しない**
- 暗号アルゴリズムが完璧でも、鍵が漏れれば無意味
- PKIが機能しても、認証局が侵害されれば無意味
- システムが堅牢でも、人間がだまされれば無意味

## 暗号基礎 完了まとめ

### カバーした範囲

| トピック | 内容 | セキュリティ観点 |
|----------|------|-----------------|
| 対称鍵暗号 | 同じ鍵で暗号化・復号 | 鍵配送問題 |
| 非対称鍵暗号 | 公開鍵・秘密鍵 | 計算量の非対称性 |
| ハイブリッド暗号 | 両者の組み合わせ | 実用的な方式（HTTPS） |
| ハッシュ | 元に戻せない変換 | ソルト、ストレッチング |
| PKI | 公開鍵の信頼性担保 | 認証局への攻撃 |

### 貫く原理

1. **計算量的セキュリティ**: 正規ユーザーは簡単、攻撃者は困難
2. **防御の多層性**: 各層に異なる防御手段
3. **最も弱いところが全体を決める**: 技術・ガバナンス・運用の総合力

## Phase 1 進捗状況

- [x] ネットワークセキュリティ基礎（2026-01-01 完了）
- [x] 暗号基礎（2026-01-02 完了）
- [ ] Linux セキュリティ（次回）

## 明日やること

### Phase 1 最終項目

**Linux セキュリティ**
- ファイルパーミッション
- ユーザー・グループ管理
- sudo と権限昇格
- SELinux / AppArmor
- ログ監視

### または Phase 2 へ

- OWASP Top 10
- SQLインジェクション
- XSS（クロスサイトスクリプティング）

## 理解度（自己評価）

- [x] 攻撃を説明できる（頻度分析、鍵配送問題、レインボーテーブル、CA侵害）
- [x] 防御を説明できる（OTP、非対称鍵、ハイブリッド暗号、ソルト、PKI）
- [ ] 実践できる（実装はこれから）

## 関連リソース

- [[Concepts/]] - 暗号方式の詳細を追加予定
- [[Practice/]] - RSA実装、ハッシュ検証等の実践記録を追加予定
- [[Progress/2026-01-01]] - SYN Cookieの秘密鍵検証（計算量的セキュリティの応用例）

---

#security #cryptography #phase1 #rsa #hybrid-encryption
