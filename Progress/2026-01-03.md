---
date: 2026-01-03
phase: 2
topic: Web Security
tags: [security, web, owasp, learning]
---

# 2026-01-03: Web Security Basics

## 学習トピック

### 1. SQLインジェクション
- ユーザー入力がSQLコードとして実行される
- 対策: パラメータ化クエリ（データとコードの構造的分離）

### 2. XSS（Cross-Site Scripting）
- ユーザー入力がブラウザでJavaScriptとして実行される
- 対策: 出力時のコンテキスト別エスケープ
- 入力時は検証、出力時はエスケープ

### 3. IDOR（Insecure Direct Object Reference）
- 認証と認可の違い
  - 認証: あなたは誰か
  - 認可: あなたは何ができるか
- URLのIDを変えるだけで他人のデータにアクセス
- 対策: リソースの所有者確認

### 4. CSRF（Cross-Site Request Forgery）
- 被害者のブラウザを経由した不正リクエスト
- ブラウザがCookieを自動送信する仕様を悪用
- 対策: CSRFトークンで「自サイト発か」を確認

### 5. SSRF（Server-Side Request Forgery）
- サーバーを踏み台にして内部ネットワークにアクセス
- 169.254.169.254（クラウドメタデータ）への攻撃
- Capital One事件（2019年、1億人分の情報漏洩）
- 対策: URL検証、内部IPのブロック、許可リスト

### 6. 暗号化の失敗（Cryptographic Failures）
- 平文保存、弱いハッシュ（MD5/SHA1）の危険性
- 正しいパスワード保存: bcrypt/Argon2 + salt
- 通信の暗号化（HTTPS必須）

### 7. セキュリティ設定ミス（Security Misconfiguration）
- バージョン情報の漏洩（Apache/PHP版数）
- デフォルトパスワード、デバッグモードON
- コードは局所的な穴、設定ミスは穴の開示+穴そのものにもなる

### 8. 脆弱なコンポーネント（Vulnerable Components）
- 依存関係の増加によるリスク
- Log4Shell（2021年）: CVSS 10.0、世界規模の影響
- 対策: SBOM、自動スキャン、最小依存の原則
- 便利さとセキュリティの著しいトレードオフ

### 9. 認証の失敗（Identification and Authentication Failures）
- セッションハイジャック → アカウント乗っ取りへの発展
- セッションIDの要件: 128bit以上、暗号論的乱数、HTTPS必須
- 重要操作には再認証を要求（パスワード変更、MFA変更等）
- 通常操作と重要操作の権限を分離

### 10. ログと監視の失敗（Security Logging and Monitoring Failures）
- ログの3つの役割: 検知、追跡、抑止
- 記録すべきイベント: 認証系、権限系、異常系
- リモートログサーバーで証拠隠滅を防止（Phase 1で学習済み）

## 核心原理：OWASP Top 10 完全版

**すべての脆弱性は「分離の欠如」に起因する**

| # | 脆弱性 | 分離すべきもの |
|---|--------|--------------|
| 1 | SQLi | コード / データ |
| 2 | XSS | コード / データ |
| 3 | IDOR | ユーザー / 権限 |
| 4 | CSRF | 認証 / 操作の正当性 |
| 5 | SSRF | 外部 / 内部リソース |
| 6 | 暗号化の失敗 | 平文 / 暗号化データ |
| 7 | 設定ミス | 開発 / 本番設定 |
| 8 | 脆弱なコンポーネント | 信頼コード / 外部依存 |
| 9 | 認証の失敗 | 通常操作 / 重要操作 |
| 10 | ログ監視の失敗 | 発生 / 記録・検知 |

## Phase 1との接続

- Phase 1: 構造で分離（passwd/shadow、ハイブリッド暗号）
- Phase 2: 信頼境界で分離（データ/コード、ユーザー/権限）

セキュリティの本質は「混ぜてはいけないものを構造的に分ける」こと。

## 次のステップ

- Phase 2残り: SQLインジェクション深掘り、XSS深掘り、認証・認可深掘り
- 実践演習: PortSwigger Web Security Academy
- Phase 3: クラウド・コンテナセキュリティ

---

## Phase 3: クラウド・コンテナセキュリティ

### AWSセキュリティ

#### 共有責任モデル
- 「クラウドの」セキュリティ → AWS
- 「クラウド内の」セキュリティ → 顧客
- マンション比喩: オートロック（AWS）vs 部屋の鍵（顧客）

#### よくある事故
- S3バケットの公開設定ミス
- IAMの過剰権限（`Action: "*"`）
- SSRF → メタデータサービス（169.254.169.254）で認証情報窃取

#### IAMセキュリティ
- 最小権限の原則
- 権限昇格攻撃（iam:CreatePolicy + iam:AttachUserPolicy）
- PassRole攻撃（弱い権限から強い権限への踏み台）
- Permission Boundary（権限の上限設定）

### コンテナセキュリティ

#### コンテナとは
- 「アプリと実行に必要な全てをパッケージ化」
- VMとの違い: カーネル共有（軽量だが脱獄リスク）
- Git = コードのバージョン管理、Docker = 「動く状態」のバージョン管理

#### セキュリティリスク
- カーネル共有 → コンテナエスケープ（脱獄）
- --privileged, -v /:/host → 事実上のホストアクセス
- rootユーザー実行 → 脱獄時に権限昇格

#### ベストプラクティス
- 非rootで実行
- 最小イメージ（alpine, distroless）
- 公式/検証済みイメージのみ
- 脆弱性スキャン

### 抽象化レベルの理解

| レベル | 例 | 顧客責任 |
|--------|-----|----------|
| IaaS | EC2 | OS、アプリ、データ |
| コンテナ | ECS, Docker | イメージ、アプリ、データ |
| PaaS | Vercel, Heroku | コード、データのみ |

#### 自分の気づき
> Vercelが「意味不明なのに便利」だった理由 = 見事なカプセル化。
> Docker/コンテナの概念を全て隠蔽し、git pushだけで本番デプロイ可能にしている。
> 抽象化の恩恵を受けていたが、裏の仕組みを知ることで「選択」できるようになる。

## 全Phase共通原則

**分離の欠如が脆弱性を生む**

| Phase | 分離すべきもの |
|-------|--------------|
| Phase 1 | passwd/shadow、公開鍵/秘密鍵 |
| Phase 2 | コード/データ、認証/認可 |
| Phase 3 | 操作権限/権限管理権限、ホスト/コンテナ |

## 作成した深掘り記事

今日作成した詳細解説記事:
- `Concepts/sqli-deep-dive.md` - SQLインジェクションの構造的理解
- `Concepts/xss-deep-dive.md` - XSSの3分類と防御戦略
- `Concepts/authentication-deep-dive.md` - 認証・認可の構造的分離

---

## 深掘りセッション

### 作成した記事（6本）

| ファイル | トピック | 核心 |
|----------|----------|------|
| sqli-deep-dive.md | SQLインジェクション | UNION攻撃、WAFバイパス |
| xss-deep-dive.md | XSS | 3種類、CSPバイパス |
| authentication-deep-dive.md | 認証 | セッション vs JWT、alg:none |
| container-deep-dive.md | コンテナ | ライフサイクル、サプライチェーン |
| docker-deep-dive.md | Docker | Rootless、ネットワーク分離 |
| linux-kernel-deep-dive.md | Linuxカーネル | 5層防御、クラウド基盤 |

### Linuxカーネルセキュリティ

5層の防御:
1. Namespace - 何が見えるか
2. cgroups - どれだけ使えるか
3. Capabilities - どの特権操作ができるか
4. seccomp - どのsyscallを呼べるか
5. SELinux/AppArmor - 何にアクセスできるか（MAC）

### 得た洞察

1. **Linuxが全ての基盤**
   - Docker、Kubernetes、AWS/GCP/Azure、全てがLinuxカーネル機能の上に構築
   - 1991年のプロジェクトが世界のインフラを支えている

2. **セキュリティ機能の二面性**
   - 防御者が使えば盾、攻撃者が使えば武器
   - 権限を取得されたら、防御機能は攻撃ツールになる

3. **設計思想の継承**
   - Unix哲学（1970年代）→ Linux → コンテナ/クラウド
   - 「小さなツールを組み合わせる」が50年生き続けている

4. **Vercelの理解**
   - 「意味不明なのに便利」だった理由 = カプセル化の恩恵
   - 裏の仕組みを知ることで「選択」できるようになる

5. **抽象化とトレードオフ**
   - 抽象化レベルが上がるほど楽、下がるほど本質
   - セキュリティを任せる = 制御も手放す

## 本日の総括

```
Phase 2: Web Security → 完了
  OWASP Top 10 全10項目

Phase 3: Cloud/Container → 進行中
  AWS: 共有責任モデル、IAM、SSRF
  Container: ライフサイクル、署名、スキャン
  Docker: Rootless、ネットワーク
  Linux: カーネルセキュリティ5層、クラウド基盤
```

### 一貫した原則

**全ての脆弱性は「分離の欠如」に起因する**

| Phase | 例 |
|-------|-----|
| Phase 1 | passwd/shadow、公開鍵/秘密鍵 |
| Phase 2 | コード/データ、認証/認可 |
| Phase 3 | ホスト/コンテナ、操作権限/権限管理権限 |
| カーネル | namespace、cgroups、capabilities |

## 次のステップ

- Kubernetesセキュリティ（RBAC、Pod Security、Network Policy）
- 実践演習（PortSwigger Web Security Academy）
- Phase 4: 攻撃・防御（ペネトレーションテスト基礎）
